const t="undefined"!=typeof WebAssembly?WebAssembly:"undefined"!=typeof WXWebAssembly?WXWebAssembly:void 0;if(!t)throw new Error("WebAssembly is not supported in this environment");function e(t,e){if(null===t||"object"!=typeof t)throw new TypeError(`${e} must be an object. Received ${null===t?"null":typeof t}`)}function n(t,e){if("string"!=typeof t)throw new TypeError(`${e} must be a string. Received ${null===t?"null":typeof t}`)}function r(t,e){if("function"!=typeof t)throw new TypeError(`${e} must be a function. Received ${null===t?"null":typeof t}`)}function i(t,e){if(void 0!==t)throw new TypeError(`${e} must be undefined. Received ${null===t?"null":typeof t}`)}function s(t){return!(!t||"object"!=typeof t&&"function"!=typeof t||"function"!=typeof t.then)}function o(t,e){const n=Object.create(null);return Object.keys(t).forEach((r=>{const i=t[r];Object.defineProperty(n,r,{enumerable:!0,value:e(i,r)})})),n}const a=["asyncify_get_state","asyncify_start_rewind","asyncify_start_unwind","asyncify_stop_rewind","asyncify_stop_unwind"];function u(t,e,n,r){if("function"!=typeof t.exports[r]||n<=0)return{wasm64:e,dataPtr:16,start:e?32:24,end:1024};const i=t.exports[r],s=e?Number(i(BigInt(16)+BigInt(n))):i(8+n);if(0===s)throw new Error("Allocate asyncify data failed");return e?{wasm64:e,dataPtr:s,start:s+16,end:s+16+n}:{wasm64:e,dataPtr:s,start:s+8,end:s+8+n}}class c{constructor(){this.value=void 0,this.exports=void 0,this.dataPtr=0}init(e,n,r){var i,s;if(this.exports)throw new Error("Asyncify has been initialized");if(!(e instanceof t.Memory))throw new TypeError("Require WebAssembly.Memory object");const o=n.exports;for(let t=0;t<a.length;++t)if("function"!=typeof o[a[t]])throw new TypeError("Invalid asyncify wasm");let c;const f=Boolean(r.wasm64);c=r.tryAllocate?!0===r.tryAllocate?u(n,f,4096,"malloc"):u(n,f,null!==(i=r.tryAllocate.size)&&void 0!==i?i:4096,null!==(s=r.tryAllocate.name)&&void 0!==s?s:"malloc"):{wasm64:f,dataPtr:16,start:f?32:24,end:1024},this.dataPtr=c.dataPtr,f?new BigInt64Array(e.buffer,this.dataPtr).set([BigInt(c.start),BigInt(c.end)]):new Int32Array(e.buffer,this.dataPtr).set([c.start,c.end]),this.exports=this.wrapExports(o,r.wrapExports);const h=Object.create(t.Instance.prototype);return Object.defineProperty(h,"exports",{value:this.exports}),h}assertState(){if(0!==this.exports.asyncify_get_state())throw new Error("Asyncify state error")}wrapImportFunction(t){const e=this;return function(){for(;2===e.exports.asyncify_get_state();)return e.exports.asyncify_stop_rewind(),e.value;e.assertState();const n=t.apply(this,arguments);if(!s(n))return n;e.exports.asyncify_start_unwind(e.dataPtr),e.value=n}}wrapImports(t){const e={};return Object.keys(t).forEach((n=>{const r=t[n],i={};Object.keys(r).forEach((t=>{const e=r[t];i[t]="function"==typeof e?this.wrapImportFunction(e):e})),e[n]=i})),e}wrapExportFunction(t){const e=this;return async function(){e.assertState();let n=t.apply(this,arguments);for(;1===e.exports.asyncify_get_state();)e.exports.asyncify_stop_unwind(),e.value=await e.value,e.assertState(),e.exports.asyncify_start_rewind(e.dataPtr),n=t.call(this);return e.assertState(),n}}wrapExports(t,e){return o(t,((t,n)=>{let r=-1!==a.indexOf(n)||"function"!=typeof t;return Array.isArray(e)&&(r=r||-1===e.indexOf(n)),r?t:this.wrapExportFunction(t)}))}}function f(t){if(t&&"object"!=typeof t)throw new TypeError("imports must be an object or undefined")}function h(e,n){return"undefined"!=typeof wx&&"undefined"!=typeof __wxConfig?t.instantiate(e,n):fetch(e).then((t=>t.arrayBuffer())).then((e=>t.instantiate(e,n)))}function g(e,n){let r;if(f(n),n=null!=n?n:{},e instanceof ArrayBuffer||ArrayBuffer.isView(e))return t.instantiate(e,n);if(e instanceof t.Module)return t.instantiate(e,n).then((t=>({instance:t,module:e})));if("string"!=typeof e&&!(e instanceof URL))throw new TypeError("Invalid source");if("function"==typeof t.instantiateStreaming){let i;try{i=fetch(e),r=t.instantiateStreaming(i,n).catch((()=>h(e,n)))}catch(t){r=h(e,n)}}else r=h(e,n);return r}function d(t,e,n){f(n),n=null!=n?n:{};const r=new c;return g(e,n=r.wrapImports(n)).then((e=>{var i;const s=e.instance.exports.memory||(null===(i=n.env)||void 0===i?void 0:i.memory);return{module:e.module,instance:r.init(s,e.instance,t)}}))}function l(e,n){let r;if(f(n),n=null!=n?n:{},e instanceof ArrayBuffer||ArrayBuffer.isView(e))r=new t.Module(e);else{if(!(e instanceof WebAssembly.Module))throw new TypeError("Invalid source");r=e}return{instance:new t.Instance(r,n),module:r}}function _(t,e,n){var r;f(n),n=null!=n?n:{};const i=new c,s=l(e,n=i.wrapImports(n)),o=s.instance.exports.memory||(null===(r=n.env)||void 0===r?void 0:r.memory);return{module:s.module,instance:i.init(o,s.instance,t)}}const y=46,E=47;function p(t){return t===E}function I(...t){let e="",r=!1;for(let i=t.length-1;i>=-1&&!r;i--){const s=i>=0?t[i]:"/";n(s,"path"),0!==s.length&&(e=`${s}/${e}`,r=s.charCodeAt(0)===E)}return e=function(t,e,n,r){let i="",s=0,o=-1,a=0,u=0;for(let c=0;c<=t.length;++c){if(c<t.length)u=t.charCodeAt(c);else{if(r(u))break;u=E}if(r(u)){if(o===c-1||1===a);else if(2===a){if(i.length<2||2!==s||i.charCodeAt(i.length-1)!==y||i.charCodeAt(i.length-2)!==y){if(i.length>2){const t=i.indexOf(n);-1===t?(i="",s=0):(i=i.slice(0,t),s=i.length-1-i.indexOf(n)),o=c,a=0;continue}if(0!==i.length){i="",s=0,o=c,a=0;continue}}e&&(i+=i.length>0?`${n}..`:"..",s=2)}else i.length>0?i+=`${n}${t.slice(o+1,c)}`:i=t.slice(o+1,c),s=c-o-1;o=c,a=0}else u===y&&-1!==a?++a:a=-1}return i}(e,!r,"/",p),r?`/${e}`:e.length>0?e:"."}const b={FD_DATASYNC:BigInt(1)<<BigInt(0),FD_READ:BigInt(1)<<BigInt(1),FD_SEEK:BigInt(1)<<BigInt(2),FD_FDSTAT_SET_FLAGS:BigInt(1)<<BigInt(3),FD_SYNC:BigInt(1)<<BigInt(4),FD_TELL:BigInt(1)<<BigInt(5),FD_WRITE:BigInt(1)<<BigInt(6),FD_ADVISE:BigInt(1)<<BigInt(7),FD_ALLOCATE:BigInt(1)<<BigInt(8),PATH_CREATE_DIRECTORY:BigInt(1)<<BigInt(9),PATH_CREATE_FILE:BigInt(1)<<BigInt(10),PATH_LINK_SOURCE:BigInt(1)<<BigInt(11),PATH_LINK_TARGET:BigInt(1)<<BigInt(12),PATH_OPEN:BigInt(1)<<BigInt(13),FD_READDIR:BigInt(1)<<BigInt(14),PATH_READLINK:BigInt(1)<<BigInt(15),PATH_RENAME_SOURCE:BigInt(1)<<BigInt(16),PATH_RENAME_TARGET:BigInt(1)<<BigInt(17),PATH_FILESTAT_GET:BigInt(1)<<BigInt(18),PATH_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(19),PATH_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(20),FD_FILESTAT_GET:BigInt(1)<<BigInt(21),FD_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(22),FD_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(23),PATH_SYMLINK:BigInt(1)<<BigInt(24),PATH_REMOVE_DIRECTORY:BigInt(1)<<BigInt(25),PATH_UNLINK_FILE:BigInt(1)<<BigInt(26),POLL_FD_READWRITE:BigInt(1)<<BigInt(27),SOCK_SHUTDOWN:BigInt(1)<<BigInt(28),SOCK_ACCEPT:BigInt(1)<<BigInt(29)};class m extends Error{constructor(t,e){super(t),this.errno=e}getErrorMessage(){return function(t){switch(t){case 0:return"Success";case 1:return"Argument list too long";case 2:return"Permission denied";case 3:return"Address in use";case 4:return"Address not available";case 5:return"Address family not supported by protocol";case 6:return"Resource temporarily unavailable";case 7:return"Operation already in progress";case 8:return"Bad file descriptor";case 9:return"Bad message";case 10:return"Resource busy";case 11:return"Operation canceled";case 12:return"No child process";case 13:return"Connection aborted";case 14:return"Connection refused";case 15:return"Connection reset by peer";case 16:return"Resource deadlock would occur";case 17:return"Destination address required";case 18:return"Domain error";case 19:return"Quota exceeded";case 20:return"File exists";case 21:return"Bad address";case 22:return"File too large";case 23:return"Host is unreachable";case 24:return"Identifier removed";case 25:return"Illegal byte sequence";case 26:return"Operation in progress";case 27:return"Interrupted system call";case 28:return"Invalid argument";case 29:return"I/O error";case 30:return"Socket is connected";case 31:return"Is a directory";case 32:return"Symbolic link loop";case 33:return"No file descriptors available";case 34:return"Too many links";case 35:return"Message too large";case 36:return"Multihop attempted";case 37:return"Filename too long";case 38:return"Network is down";case 39:return"Connection reset by network";case 40:return"Network unreachable";case 41:return"Too many files open in system";case 42:return"No buffer space available";case 43:return"No such device";case 44:return"No such file or directory";case 45:return"Exec format error";case 46:return"No locks available";case 47:return"Link has been severed";case 48:return"Out of memory";case 49:return"No message of the desired type";case 50:return"Protocol not available";case 51:return"No space left on device";case 52:return"Function not implemented";case 53:return"Socket not connected";case 54:return"Not a directory";case 55:return"Directory not empty";case 56:return"State not recoverable";case 57:return"Not a socket";case 58:return"Not supported";case 59:return"Not a tty";case 60:return"No such device or address";case 61:return"Value too large for data type";case 62:return"Previous owner died";case 63:return"Operation not permitted";case 64:return"Broken pipe";case 65:return"Protocol error";case 66:return"Protocol not supported";case 67:return"Protocol wrong type for socket";case 68:return"Result not representable";case 69:return"Read-only file system";case 70:return"Invalid seek";case 71:return"No such process";case 72:return"Stale file handle";case 73:return"Operation timed out";case 74:return"Text file busy";case 75:return"Cross-device link";case 76:return"Capabilities insufficient";default:return"Unknown error"}}(this.errno)}}Object.defineProperty(m.prototype,"name",{configurable:!0,writable:!0,value:"WasiError"});const A=b.FD_DATASYNC|b.FD_READ|b.FD_SEEK|b.FD_FDSTAT_SET_FLAGS|b.FD_SYNC|b.FD_TELL|b.FD_WRITE|b.FD_ADVISE|b.FD_ALLOCATE|b.PATH_CREATE_DIRECTORY|b.PATH_CREATE_FILE|b.PATH_LINK_SOURCE|b.PATH_LINK_TARGET|b.PATH_OPEN|b.FD_READDIR|b.PATH_READLINK|b.PATH_RENAME_SOURCE|b.PATH_RENAME_TARGET|b.PATH_FILESTAT_GET|b.PATH_FILESTAT_SET_SIZE|b.PATH_FILESTAT_SET_TIMES|b.FD_FILESTAT_GET|b.FD_FILESTAT_SET_TIMES|b.FD_FILESTAT_SET_SIZE|b.PATH_SYMLINK|b.PATH_UNLINK_FILE|b.PATH_REMOVE_DIRECTORY|b.POLL_FD_READWRITE|b.SOCK_SHUTDOWN,T=A,w=A,B=A,N=A,S=b.FD_DATASYNC|b.FD_READ|b.FD_SEEK|b.FD_FDSTAT_SET_FLAGS|b.FD_SYNC|b.FD_TELL|b.FD_WRITE|b.FD_ADVISE|b.FD_ALLOCATE|b.FD_FILESTAT_GET|b.FD_FILESTAT_SET_SIZE|b.FD_FILESTAT_SET_TIMES|b.POLL_FD_READWRITE,D=BigInt(0),P=b.FD_FDSTAT_SET_FLAGS|b.FD_SYNC|b.FD_ADVISE|b.PATH_CREATE_DIRECTORY|b.PATH_CREATE_FILE|b.PATH_LINK_SOURCE|b.PATH_LINK_TARGET|b.PATH_OPEN|b.FD_READDIR|b.PATH_READLINK|b.PATH_RENAME_SOURCE|b.PATH_RENAME_TARGET|b.PATH_FILESTAT_GET|b.PATH_FILESTAT_SET_SIZE|b.PATH_FILESTAT_SET_TIMES|b.FD_FILESTAT_GET|b.FD_FILESTAT_SET_TIMES|b.PATH_SYMLINK|b.PATH_UNLINK_FILE|b.PATH_REMOVE_DIRECTORY|b.POLL_FD_READWRITE,F=P|S,v=b.FD_READ|b.FD_FDSTAT_SET_FLAGS|b.FD_WRITE|b.FD_FILESTAT_GET|b.POLL_FD_READWRITE|b.SOCK_SHUTDOWN,R=A,U=b.FD_READ|b.FD_FDSTAT_SET_FLAGS|b.FD_WRITE|b.FD_FILESTAT_GET|b.POLL_FD_READWRITE,L=BigInt(0);function H(t,e,n,r){const i={base:BigInt(0),inheriting:BigInt(0)};if(0===r)throw new m("Unknown file type",28);switch(r){case 4:i.base=S,i.inheriting=D;break;case 3:i.base=P,i.inheriting=F;break;case 6:case 5:i.base=v,i.inheriting=R;break;case 2:-1!==t.indexOf(e)?(i.base=U,i.inheriting=L):(i.base=B,i.inheriting=N);break;case 1:i.base=T,i.inheriting=w;break;default:i.base=BigInt(0),i.inheriting=BigInt(0)}const s=3&n;return 0===s?i.base&=~b.FD_WRITE:1===s&&(i.base&=~b.FD_READ),i}function O(t,e){let n=0;if("number"==typeof e&&e>=0)n=e;else for(let e=0;e<t.length;e++){n+=t[e].length}let r=0;const i=new Uint8Array(n);for(let e=0;e<t.length;e++){const n=t[e];i.set(n,r),r+=n.length}return i}class k{constructor(t,e,n,r,i,s,o,a){this.id=t,this.fd=e,this.path=n,this.realPath=r,this.type=i,this.rightsBase=s,this.rightsInheriting=o,this.preopen=a,this.pos=BigInt(0),this.size=BigInt(0)}seek(t,e){if(0===e)this.pos=BigInt(t);else if(1===e)this.pos+=BigInt(t);else{if(2!==e)throw new m("Unknown whence",29);this.pos=BigInt(this.size)-BigInt(t)}return this.pos}}class C extends k{constructor(t,e,n,r,i,s,o,a,u){super(e,n,r,i,s,o,a,u),this._log=t,this._buf=null}write(t){const e=t;if(this._buf&&(t=O([this._buf,t]),this._buf=null),-1===t.indexOf(10))return this._buf=t,e.byteLength;let n,r=0,i=0;for(;-1!==(n=t.indexOf(10,r));){const e=(new TextDecoder).decode(t.subarray(i,n));this._log(e),r+=n-i+1,i=n+1}return r<t.length&&(this._buf=t.slice(r)),e.byteLength}}function x(t){return t.isBlockDevice()?1:t.isCharacterDevice()?2:t.isDirectory()?3:t.isSocket()?6:t.isFile()?4:t.isSymbolicLink()?7:0}function M(t,e,n){t.setBigUint64(e,n.dev,!0),t.setBigUint64(e+8,n.ino,!0),t.setBigUint64(e+16,BigInt(x(n)),!0),t.setBigUint64(e+24,n.nlink,!0),t.setBigUint64(e+32,n.size,!0),t.setBigUint64(e+40,n.atimeMs*BigInt(1e6),!0),t.setBigUint64(e+48,n.mtimeMs*BigInt(1e6),!0),t.setBigUint64(e+56,n.ctimeMs*BigInt(1e6),!0)}class W{constructor(t){this.used=0,this.size=t.size,this.fds=Array(t.size),this.stdio=[t.in,t.out,t.err],this.print=t.print,this.printErr=t.printErr,this.insertStdio(t.in,0,"<stdin>"),this.insertStdio(t.out,1,"<stdout>"),this.insertStdio(t.err,2,"<stderr>")}insertStdio(t,e,n){const{base:r,inheriting:i}=H(this.stdio,t,2,2),s=this.insert(t,n,n,2,r,i,0);if(s.id!==e)throw new m(`id: ${s.id} !== expected: ${e}`,8);return s}insert(t,e,n,r,i,s,o){var a,u;let c,f=-1;if(this.used>=this.size){const t=2*this.size;this.fds.length=t,f=this.size,this.size=t}else for(let t=0;t<this.size;++t)if(null==this.fds[t]){f=t;break}return c="<stdout>"===e?new C(null!==(a=this.print)&&void 0!==a?a:console.log,f,t,e,n,r,i,s,o):"<stderr>"===e?new C(null!==(u=this.printErr)&&void 0!==u?u:console.error,f,t,e,n,r,i,s,o):new k(f,t,e,n,r,i,s,o),this.fds[f]=c,this.used++,c}get(t,e,n){if(t>=this.size)throw new m("Invalid fd",8);const r=this.fds[t];if(!r||r.id!==t)throw new m("Bad file descriptor",8);if((~r.rightsBase&e)!==BigInt(0)||(~r.rightsInheriting&n)!==BigInt(0))throw new m("Capabilities insufficient",76);return r}remove(t){if(t>=this.size)throw new m("Invalid fd",8);const e=this.fds[t];if(!e||e.id!==t)throw new m("Bad file descriptor",8);this.fds[t]=void 0,this.used--}}class K extends W{constructor(t){super(t),this.fs=t.fs}getFileTypeByFd(t){return x(this.fs.fstatSync(t,{bigint:!0}))}insertPreopen(t,e,n){const r=this.getFileTypeByFd(t);if(3!==r)throw new m(`Preopen not dir: ["${e}", "${n}"]`,54);const i=H(this.stdio,t,0,r);return this.insert(t,e,n,r,i.base,i.inheriting,1)}renumber(t,e){if(t===e)return;if(t>=this.size||e>=this.size)throw new m("Invalid fd",8);const n=this.fds[t],r=this.fds[e];if(!n||!r||n.id!==t||r.id!==e)throw new m("Invalid fd",8);this.fs.closeSync(n.fd),this.fds[t]=this.fds[e],this.fds[t].id=t,this.fds[e]=void 0,this.used--}}class z extends W{constructor(t){super(t)}async getFileTypeByFd(t){return x(await t.stat({bigint:!0}))}async insertPreopen(t,e,n){const r=await this.getFileTypeByFd(t);if(3!==r)throw new m(`Preopen not dir: ["${e}", "${n}"]`,54);const i=H(this.stdio,t.fd,0,r);return this.insert(t,e,n,r,i.base,i.inheriting,1)}async renumber(t,e){if(t===e)return;if(t>=this.size||e>=this.size)throw new m("Invalid fd",8);const n=this.fds[t],r=this.fds[e];if(!n||!r||n.id!==t||r.id!==e)throw new m("Invalid fd",8);await n.fd.close(),this.fds[t]=this.fds[e],this.fds[t].id=t,this.fds[e]=void 0,this.used--}}const G=function(){return t.Memory}();class Y extends G{constructor(t){super(t)}get HEAP8(){return new Int8Array(super.buffer)}get HEAPU8(){return new Uint8Array(super.buffer)}get HEAP16(){return new Int16Array(super.buffer)}get HEAPU16(){return new Uint16Array(super.buffer)}get HEAP32(){return new Int32Array(super.buffer)}get HEAPU32(){return new Uint32Array(super.buffer)}get HEAP64(){return new BigInt64Array(super.buffer)}get HEAPU64(){return new BigUint64Array(super.buffer)}get HEAPF32(){return new Float32Array(super.buffer)}get HEAPF64(){return new Float64Array(super.buffer)}get view(){return new DataView(super.buffer)}}function j(e){return Object.getPrototypeOf(e)===t.Memory.prototype&&Object.setPrototypeOf(e,Y.prototype),e}function $(){const e=t.Function;if("function"!=typeof e)throw new Error('WebAssembly.Function is not supported in this environment. If you are using V8 based browser like Chrome, try to specify --js-flags="--wasm-staging --experimental-wasm-stack-switching"');return e}function V(t,e,n){const r=$();if("function"!=typeof t)throw new TypeError("Function required");const i=e.slice(0);return i.unshift("externref"),new r({parameters:i,results:n},t,{suspending:"first"})}function Z(t){const e=$();if("function"!=typeof t)throw new TypeError("Function required");return new e({parameters:[...e.type(t).parameters.slice(1)],results:["externref"]},t,{promising:"first"})}function q(t,e){return o(t,((t,n)=>{let r="function"!=typeof t;return Array.isArray(e)&&(r=r||-1===e.indexOf(n)),r?t:Z(t)}))}function X(t,e){if(0===t.length||0===e.length)return 0;let n=0,r=e.length-n;for(let i=0;i<t.length;++i){const s=t[i];if(r<s.length)return s.set(e.subarray(n,n+r),0),n+=r,r=0,n;s.set(e.subarray(n,n+s.length),0),n+=s.length,r-=s.length}return n}const Q=new WeakMap,J=new WeakMap,tt=new WeakMap;function et(t){return Q.get(t)}function nt(t){const e=tt.get(t);if(!e)throw new Error("filesystem is unavailable");return e}function rt(t){if(t instanceof m)return t.errno;switch(t.code){case"ENOENT":return 44;case"EBADF":return 8;case"EINVAL":return 28;case"EPERM":return 63;case"EPROTO":return 65;case"EEXIST":return 20;case"ENOTDIR":return 54;case"EMFILE":return 33;case"EACCES":return 2;case"EISDIR":return 31;case"ENOTEMPTY":return 55;case"ENOSYS":return 52}throw t}function it(t,e,n){return function(t,e){return Object.defineProperty(e,"name",{value:t}),e}(e,(function(){let e;try{e=n.apply(t,arguments)}catch(t){return rt(t)}return s(e)?e.then((t=>t),rt):e}))}function st(t,e,n,r){let i=I(e.realPath,n);if(1==(1&r))try{i=t.readlinkSync(i)}catch(t){if("EINVAL"!==t.code&&"ENOENT"!==t.code)throw t}return i}async function ot(t,e,n,r){let i=I(e.realPath,n);if(1==(1&r))try{i=await t.promises.readlink(i)}catch(t){if("EINVAL"!==t.code&&"ENOENT"!==t.code)throw t}return i}const at=new TextEncoder,ut=new TextDecoder;function ct(){const t=window.prompt();if(null===t)return new Uint8Array;return(new TextEncoder).encode(t+"\n")}class ft{constructor(e,n,r,i,s,o){this.args_get=it(this,"args_get",(function(t,e){if(t=Number(t),e=Number(e),0===t||0===e)return 28;const{HEAPU8:n,view:r}=et(this),i=J.get(this).args;for(let s=0;s<i.length;++s){const o=i[s];r.setInt32(t,e,!0),t+=4;const a=at.encode(o+"\0");n.set(a,e),e+=a.length}return 0})),this.args_sizes_get=it(this,"args_sizes_get",(function(t,e){if(t=Number(t),e=Number(e),0===t||0===e)return 28;const{view:n}=et(this),r=J.get(this).args;return n.setUint32(t,r.length,!0),n.setUint32(e,at.encode(r.join("\0")+"\0").length,!0),0})),this.environ_get=it(this,"environ_get",(function(t,e){if(t=Number(t),e=Number(e),0===t||0===e)return 28;const{HEAPU8:n,view:r}=et(this),i=J.get(this).env;for(let s=0;s<i.length;++s){const o=i[s];r.setInt32(t,e,!0),t+=4;const a=at.encode(o+"\0");n.set(a,e),e+=a.length}return 0})),this.environ_sizes_get=it(this,"environ_sizes_get",(function(t,e){if(t=Number(t),e=Number(e),0===t||0===e)return 28;const{view:n}=et(this),r=J.get(this);return n.setUint32(t,r.env.length,!0),n.setUint32(e,at.encode(r.env.join("\0")+"\0").length,!0),0})),this.clock_res_get=it(this,"clock_res_get",(function(t,e){if(0===(e=Number(e)))return 28;const{view:n}=et(this);switch(t){case 0:return n.setBigUint64(e,BigInt(1e6),!0),0;case 1:case 2:case 3:return n.setBigUint64(e,BigInt(1e3),!0),0;default:return 28}})),this.clock_time_get=it(this,"clock_time_get",(function(t,e,n){if(0===(n=Number(n)))return 28;const{view:r}=et(this);switch(t){case 0:return r.setBigUint64(n,BigInt(Date.now())*BigInt(1e6),!0),0;case 1:case 2:case 3:{const t=performance.now(),e=Math.trunc(t),i=Math.floor(1e3*(t-e)),s=BigInt(e)*BigInt(1e9)+BigInt(i)*BigInt(1e6);return r.setBigUint64(n,s,!0),0}default:return 28}})),this.fd_advise=it(this,"fd_advise",(function(t,e,n,r){return 52})),this.fd_fdstat_get=it(this,"fd_fdstat_get",(function(t,e){if(0===(e=Number(e)))return 28;const n=J.get(this).fds.get(t,BigInt(0),BigInt(0)),{view:r}=et(this);return r.setUint16(e,n.type,!0),r.setUint16(e+2,0,!0),r.setBigUint64(e+8,n.rightsBase,!0),r.setBigUint64(e+16,n.rightsInheriting,!0),0})),this.fd_fdstat_set_flags=it(this,"fd_fdstat_set_flags",(function(t,e){return 52})),this.fd_fdstat_set_rights=it(this,"fd_fdstat_set_rights",(function(t,e,n){const r=J.get(this).fds.get(t,BigInt(0),BigInt(0));return(e|r.rightsBase)>r.rightsBase||(n|r.rightsInheriting)>r.rightsInheriting?76:(r.rightsBase=e,r.rightsInheriting=n,0)})),this.fd_prestat_get=it(this,"fd_prestat_get",(function(t,e){if(0===(e=Number(e)))return 28;const n=J.get(this);let r;try{r=n.fds.get(t,BigInt(0),BigInt(0))}catch(t){if(t instanceof m)return t.errno;throw t}if(1!==r.preopen)return 28;const{view:i}=et(this);return i.setUint32(e,0,!0),i.setUint32(e+4,at.encode(r.path).length+1,!0),0})),this.fd_prestat_dir_name=it(this,"fd_prestat_dir_name",(function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const r=J.get(this).fds.get(t,BigInt(0),BigInt(0));if(1!==r.preopen)return 8;const i=at.encode(r.path+"\0");if(i.length>n)return 42;const{HEAPU8:s}=et(this);return s.set(i,e),0})),this.fd_seek=it(this,"fd_seek",(function(t,e,n,r){if(0===(r=Number(r)))return 28;if(0===t||1===t||2===t)return 0;const i=J.get(this).fds.get(t,b.FD_SEEK,BigInt(0)).seek(e,n),{view:s}=et(this);return s.setBigUint64(r,i,!0),0})),this.fd_tell=it(this,"fd_tell",(function(t,e){const n=J.get(this).fds.get(t,b.FD_TELL,BigInt(0)),r=BigInt(n.pos),{view:i}=et(this);return i.setBigUint64(Number(e),r,!0),0})),this.poll_oneoff=it(this,"poll_oneoff",(function(t,e,n,r){if(t=Number(t),e=Number(e),r=Number(r),n=Number(n),n>>>=0,0===t||0===e||0===n||0===r)return 28;const{view:i}=et(this);i.setUint32(r,0,!0);let s,o=0,a=BigInt(0),u=BigInt(0),c=0,f=BigInt(0);const h=Array(n);for(o=0;o<n;o++){s=t+48*o;const e=i.getBigUint64(s,!0),n=i.getUint8(s+8),r=i.getUint32(s+16,!0),a=i.getBigUint64(s+24,!0),u=i.getBigUint64(s+32,!0),c=i.getUint16(s+40,!0);h[o]={userdata:e,type:n,u:{clock:{clock_id:r,timeout:a,precision:u,flags:c},fd_readwrite:{fd:r}}}}const g=[];for(o=0;o<n;o++)switch(s=h[o],s.type){case 0:if(1===s.u.clock.flags){const t=BigInt(Date.now())*BigInt(1e6);u=s.u.clock.timeout-t}else u=s.u.clock.timeout;(0===c||u<f)&&(f=u,a=s.userdata,c=1);break;case 1:case 2:g.push(s);break;default:return 28}if(g.length>0){for(o=0;o<g.length;o++){const t=g[o],n=e+32*o;i.setBigUint64(n,t.userdata,!0),i.setUint32(n+8,52,!0),i.setUint32(n+12,t.type,!0),i.setBigUint64(n+16,BigInt(0),!0),i.setUint16(n+24,0,!0),i.setUint32(r,1,!0)}return i.setUint32(r,g.length,!0),0}if(c){!function(t,e){const n=Date.now()+t;let r=!1;for(;Date.now()<n;)if(e()){r=!0;break}}(Number(f/BigInt(1e6)),(()=>!1));const t=e;i.setBigUint64(t,a,!0),i.setUint32(t+8,0,!0),i.setUint32(t+12,0,!0),i.setUint32(r,1,!0)}return 0})),this.proc_exit=it(this,"proc_exit",(function(t){return"object"==typeof process&&null!==process&&"function"==typeof process.exit&&process.exit(t),0})),this.proc_raise=it(this,"proc_raise",(function(t){return 52})),this.sched_yield=it(this,"sched_yield",(function(){return 0})),this.random_get="undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues?it(this,"random_get",(function(t,e){if(0===(t=Number(t)))return 28;e=Number(e);const{HEAPU8:n,view:r}=et(this);if("function"==typeof SharedArrayBuffer&&n.buffer instanceof SharedArrayBuffer||"[object SharedArrayBuffer]"===Object.prototype.toString.call(n.buffer)){for(let n=t;n<t+e;++n)r.setUint8(n,Math.floor(256*Math.random()));return 0}let i;const s=65536;for(i=0;i+s<e;i+=s)crypto.getRandomValues(n.subarray(t+i,t+i+s));return crypto.getRandomValues(n.subarray(t+i,t+e)),0})):it(this,"random_get",(function(t,e){if(0===(t=Number(t)))return 28;e=Number(e);const{view:n}=et(this);for(let r=t;r<t+e;++r)n.setUint8(r,Math.floor(256*Math.random()));return 0})),this.sock_recv=it(this,"sock_recv",(function(){return 58})),this.sock_send=it(this,"sock_send",(function(){return 58})),this.sock_shutdown=it(this,"sock_shutdown",(function(){return 58})),J.set(this,{fds:r,args:e,env:n}),s&&tt.set(this,s);const a=this;function u(t,e,n,r,s){a[t]=i?o?o.wrapImportFunction(it(a,t,n)):V(it(a,t,n),r,s):it(a,t,e)}function c(t,e,n,r){const i=J.get(this).fds.get(t,b.FD_FILESTAT_SET_TIMES,BigInt(0));return 2==(2&r)&&(e=BigInt(1e6*Date.now())),8==(8&r)&&(n=BigInt(1e6*Date.now())),{fileDescriptor:i,atim:e,mtim:n}}function f(t,e,n,r){const i=(e&(b.FD_READ|b.FD_READDIR))!==BigInt(0),s=(e&(b.FD_DATASYNC|b.FD_WRITE|b.FD_ALLOCATE|b.FD_FILESTAT_SET_SIZE))!==BigInt(0);let o=s?i?2:1:0,a=b.PATH_OPEN,u=e|n;return 0!=(1&t)&&(o|=64,a|=b.PATH_CREATE_FILE),0!=(2&t)&&(o|=65536),0!=(4&t)&&(o|=128),0!=(8&t)&&(o|=512,a|=b.PATH_FILESTAT_SET_SIZE),0!=(1&r)&&(o|=1024),0!=(2&r)&&(u|=b.FD_DATASYNC),0!=(4&r)&&(o|=2048),0!=(8&r)&&(o|=1052672,u|=b.FD_SYNC),0!=(16&r)&&(o|=1052672,u|=b.FD_SYNC),s&&0==(1536&o)&&(u|=b.FD_SEEK),{flags:o,needed_base:a,needed_inheriting:u}}u("fd_allocate",(function(t,e,n){const r=J.get(this),i=nt(this),s=r.fds.get(t,b.FD_ALLOCATE,BigInt(0));return i.fstatSync(s.fd,{bigint:!0}).size<e+n&&i.ftruncateSync(s.fd,Number(e+n)),0}),(async function(t,e,n){const r=J.get(this).fds.get(t,b.FD_ALLOCATE,BigInt(0)).fd;return(await r.stat({bigint:!0})).size<e+n&&await r.truncate(Number(e+n)),0}),["i32","i64","f64"],["i32"]),u("fd_close",(function(t){const e=J.get(this),n=e.fds.get(t,BigInt(0),BigInt(0));return nt(this).closeSync(n.fd),e.fds.remove(t),0}),(async function(t){const e=J.get(this),n=e.fds.get(t,BigInt(0),BigInt(0));return await n.fd.close(),e.fds.remove(t),0}),["i32"],["i32"]),u("fd_datasync",(function(t){const e=J.get(this).fds.get(t,b.FD_DATASYNC,BigInt(0));return nt(this).fdatasyncSync(e.fd),0}),(async function(t){const e=J.get(this).fds.get(t,b.FD_DATASYNC,BigInt(0));return await e.fd.datasync(),0}),["i32"],["i32"]),u("fd_filestat_get",(function(t,e){if(0===(e=Number(e)))return 28;const n=J.get(this).fds.get(t,b.FD_FILESTAT_GET,BigInt(0)),r=nt(this).fstatSync(n.fd,{bigint:!0}),{view:i}=et(this);return M(i,e,r),0}),(async function(t,e){if(0===(e=Number(e)))return 28;const n=J.get(this).fds.get(t,b.FD_FILESTAT_GET,BigInt(0)).fd,r=await n.stat({bigint:!0}),{view:i}=et(this);return M(i,e,r),0}),["i32","i32"],["i32"]),u("fd_filestat_set_size",(function(t,e){const n=J.get(this).fds.get(t,b.FD_FILESTAT_SET_SIZE,BigInt(0));return nt(this).ftruncateSync(n.fd,Number(e)),0}),(async function(t,e){const n=J.get(this).fds.get(t,b.FD_FILESTAT_SET_SIZE,BigInt(0)).fd;return await n.truncate(Number(e)),0}),["i32","i64"],["i32"]),u("fd_filestat_set_times",(function(t,e,n,r){const{fileDescriptor:i,atim:s,mtim:o}=c.call(this,t,e,n,r);return nt(this).futimesSync(i.fd,Number(s),Number(o)),0}),(async function(t,e,n,r){const{fileDescriptor:i,atim:s,mtim:o}=c.call(this,t,e,n,r),a=i.fd;return await a.utimes(Number(s),Number(o)),0}),["i32","i64","i64","i32"],["i32"]),u("fd_pread",(function(t,e,n,r,i){if(e=Number(e),i=Number(i),0===e||0===i)return 28;const{HEAPU8:s,view:o}=et(this),a=J.get(this).fds.get(t,b.FD_READ|b.FD_SEEK,BigInt(0));let u=0;const c=Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,i=o.getInt32(r,!0),a=o.getUint32(r+4,!0);return u+=a,s.subarray(i,i+a)}));let f=0;const h=new Uint8Array(u);h._isBuffer=!0;const g=nt(this).readSync(a.fd,h,0,h.length,Number(r));return f=h?X(c,h.subarray(0,g)):0,o.setUint32(i,f,!0),0}),(async function(t,e,n,r,i){if(e=Number(e),i=Number(i),0===e||0===i)return 28;const{HEAPU8:s,view:o}=et(this),a=J.get(this).fds.get(t,b.FD_READ|b.FD_SEEK,BigInt(0));let u=0;const c=Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,i=o.getInt32(r,!0),a=o.getUint32(r+4,!0);return u+=a,s.subarray(i,i+a)}));let f=0;const h=new Uint8Array(u);h._isBuffer=!0;const{bytesRead:g}=await a.fd.read(h,0,h.length,Number(r));return f=h?X(c,h.subarray(0,g)):0,o.setUint32(i,f,!0),0}),["i32","i32","i32","i64","i32"],["i32"]),u("fd_pwrite",(function(t,e,n,r,i){if(e=Number(e),i=Number(i),0===e||0===i)return 28;const{HEAPU8:s,view:o}=et(this),a=J.get(this).fds.get(t,b.FD_WRITE|b.FD_SEEK,BigInt(0)),u=O(Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,i=o.getInt32(r,!0),a=o.getUint32(r+4,!0);return s.subarray(i,i+a)}))),c=nt(this).writeSync(a.fd,u,0,u.length,Number(r));return o.setUint32(i,c,!0),0}),(async function(t,e,n,r,i){if(e=Number(e),i=Number(i),0===e||0===i)return 28;const{HEAPU8:s,view:o}=et(this),a=J.get(this).fds.get(t,b.FD_WRITE|b.FD_SEEK,BigInt(0)),u=O(Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,i=o.getInt32(r,!0),a=o.getUint32(r+4,!0);return s.subarray(i,i+a)}))),{bytesWritten:c}=await a.fd.write(u,0,u.length,Number(r));return o.setUint32(i,c,!0),0}),["i32","i32","i32","i64","i32"],["i32"]),u("fd_read",(function(t,e,n,r){if(e=Number(e),r=Number(r),0===e||0===r)return 28;const{HEAPU8:i,view:s}=et(this),o=J.get(this).fds.get(t,b.FD_READ,BigInt(0));let a=0;const u=Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,o=s.getInt32(r,!0),u=s.getUint32(r+4,!0);return a+=u,i.subarray(o,o+u)}));let c,f=0;if(0===t){if("undefined"==typeof window||"function"!=typeof window.prompt)return 58;c=ct(),f=c?X(u,c):0}else{c=new Uint8Array(a),c._isBuffer=!0;const t=nt(this).readSync(o.fd,c,0,c.length,Number(o.pos));f=c?X(u,c.subarray(0,t)):0,o.pos+=BigInt(f)}return s.setUint32(r,f,!0),0}),(async function(t,e,n,r){if(e=Number(e),r=Number(r),0===e||0===r)return 28;const{HEAPU8:i,view:s}=et(this),o=J.get(this).fds.get(t,b.FD_READ,BigInt(0));let a=0;const u=Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,o=s.getInt32(r,!0),u=s.getUint32(r+4,!0);return a+=u,i.subarray(o,o+u)}));let c,f=0;if(0===t){if("undefined"==typeof window||"function"!=typeof window.prompt)return 58;c=ct(),f=c?X(u,c):0}else{c=new Uint8Array(a),c._isBuffer=!0;const{bytesRead:t}=await o.fd.read(c,0,c.length,Number(o.pos));f=c?X(u,c.subarray(0,t)):0,o.pos+=BigInt(f)}return s.setUint32(r,f,!0),0}),["i32","i32","i32","i32"],["i32"]),u("fd_readdir",(function(t,e,n,r,i){if(e=Number(e),n=Number(n),i=Number(i),0===e||0===i)return 0;const s=J.get(this).fds.get(t,b.FD_READDIR,BigInt(0)),o=nt(this),a=o.readdirSync(s.realPath,{withFileTypes:!0}),{HEAPU8:u,view:c}=et(this);let f=0;for(let t=Number(r);t<a.length;t++){const r=at.encode(a[t].name),i=o.statSync(I(s.realPath,a[t].name),{bigint:!0}),c=new Uint8Array(24+r.byteLength),h=new DataView(c.buffer);let g;h.setBigUint64(0,BigInt(t+1),!0),h.setBigUint64(8,BigInt(i.ino?i.ino:0),!0),h.setUint32(16,r.byteLength,!0),g=a[t].isFile()?4:a[t].isDirectory()?3:a[t].isSymbolicLink()?7:a[t].isCharacterDevice()?2:a[t].isBlockDevice()?1:a[t].isSocket()?6:0,h.setUint8(20,g),c.set(r,24);const d=c.slice(0,Math.min(c.length,n-f));u.set(d,e+f),f+=d.byteLength}return c.setUint32(i,f,!0),0}),(async function(t,e,n,r,i){if(e=Number(e),n=Number(n),i=Number(i),0===e||0===i)return 0;const s=J.get(this).fds.get(t,b.FD_READDIR,BigInt(0)),o=nt(this),a=await o.promises.readdir(s.realPath,{withFileTypes:!0}),{HEAPU8:u,view:c}=et(this);let f=0;for(let t=Number(r);t<a.length;t++){const r=at.encode(a[t].name),i=await o.promises.stat(I(s.realPath,a[t].name),{bigint:!0}),c=new Uint8Array(24+r.byteLength),h=new DataView(c.buffer);let g;h.setBigUint64(0,BigInt(t+1),!0),h.setBigUint64(8,BigInt(i.ino?i.ino:0),!0),h.setUint32(16,r.byteLength,!0),g=a[t].isFile()?4:a[t].isDirectory()?3:a[t].isSymbolicLink()?7:a[t].isCharacterDevice()?2:a[t].isBlockDevice()?1:a[t].isSocket()?6:0,h.setUint8(20,g),c.set(r,24);const d=c.slice(0,Math.min(c.length,n-f));u.set(d,e+f),f+=d.byteLength}return c.setUint32(i,f,!0),0}),["i32","i32","i32","i64","i32"],["i32"]),u("fd_renumber",(function(t,e){return J.get(this).fds.renumber(e,t),0}),(async function(t,e){const n=J.get(this);return await n.fds.renumber(e,t),0}),["i32","i32"],["i32"]),u("fd_sync",(function(t){const e=J.get(this).fds.get(t,b.FD_SYNC,BigInt(0));return nt(this).fsyncSync(e.fd),0}),(async function(t){const e=J.get(this).fds.get(t,b.FD_SYNC,BigInt(0));return await e.fd.sync(),0}),["i32"],["i32"]),u("fd_write",(function(t,e,n,r){if(e=Number(e),r=Number(r),0===e||0===r)return 28;const{HEAPU8:i,view:s}=et(this),o=J.get(this).fds.get(t,b.FD_WRITE,BigInt(0)),a=O(Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,o=s.getInt32(r,!0),a=s.getUint32(r+4,!0);return i.subarray(o,o+a)})));let u;if(1===t||2===t)u=o.write(a);else{u=nt(this).writeSync(o.fd,a,0,a.length,Number(o.pos)),o.pos+=BigInt(u)}return s.setUint32(r,u,!0),0}),(async function(t,e,n,r){if(e=Number(e),r=Number(r),0===e||0===r)return 28;const{HEAPU8:i,view:s}=et(this),o=J.get(this).fds.get(t,b.FD_WRITE,BigInt(0)),a=O(Array.from({length:Number(n)},((t,n)=>{const r=e+8*n,o=s.getInt32(r,!0),a=s.getUint32(r+4,!0);return i.subarray(o,o+a)})));let u;return 1===t||2===t?u=o.write(a):(u=await(await o.fd.write(a,0,a.length,Number(o.pos))).bytesWritten,o.pos+=BigInt(u)),s.setUint32(r,u,!0),0}),["i32","i32","i32","i32"],["i32"]),u("path_create_directory",(function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const{HEAPU8:r}=et(this),i=J.get(this).fds.get(t,b.PATH_CREATE_DIRECTORY,BigInt(0));let s=ut.decode(r.subarray(e,e+n));s=I(i.realPath,s);return nt(this).mkdirSync(s),0}),(async function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const{HEAPU8:r}=et(this),i=J.get(this).fds.get(t,b.PATH_CREATE_DIRECTORY,BigInt(0));let s=ut.decode(r.subarray(e,e+n));s=I(i.realPath,s);const o=nt(this);return await o.promises.mkdir(s),0}),["i32","i32","i32"],["i32"]),u("path_filestat_get",(function(t,e,n,r,i){if(n=Number(n),r=Number(r),i=Number(i),0===n||0===i)return 28;const{HEAPU8:s,view:o}=et(this),a=J.get(this).fds.get(t,b.PATH_FILESTAT_GET,BigInt(0));let u=ut.decode(s.subarray(n,n+r));const c=nt(this);let f;return u=I(a.realPath,u),f=1==(1&e)?c.statSync(u,{bigint:!0}):c.lstatSync(u,{bigint:!0}),M(o,i,f),0}),(async function(t,e,n,r,i){if(n=Number(n),r=Number(r),i=Number(i),0===n||0===i)return 28;const{HEAPU8:s,view:o}=et(this),a=J.get(this).fds.get(t,b.PATH_FILESTAT_GET,BigInt(0));let u=ut.decode(s.subarray(n,n+r));const c=nt(this);let f;return u=I(a.realPath,u),f=1==(1&e)?await c.promises.stat(u,{bigint:!0}):await c.promises.lstat(u,{bigint:!0}),M(o,i,f),0}),["i32","i32","i32","i32","i32"],["i32"]),u("path_filestat_set_times",(function(t,e,n,r,i,s,o){if(n=Number(n),r=Number(r),0===n)return 28;if(-16&o)return 28;const{HEAPU8:a}=et(this),u=J.get(this).fds.get(t,b.PATH_FILESTAT_SET_TIMES,BigInt(0)),c=nt(this),f=st(c,u,ut.decode(a.subarray(n,n+r)),e);return 2==(2&o)&&(i=BigInt(1e6*Date.now())),8==(8&o)&&(s=BigInt(1e6*Date.now())),c.utimesSync(f,Number(i),Number(s)),0}),(async function(t,e,n,r,i,s,o){if(n=Number(n),r=Number(r),0===n)return 28;if(-16&o)return 28;const{HEAPU8:a}=et(this),u=J.get(this).fds.get(t,b.PATH_FILESTAT_SET_TIMES,BigInt(0)),c=nt(this),f=await ot(c,u,ut.decode(a.subarray(n,n+r)),e);return 2==(2&o)&&(i=BigInt(1e6*Date.now())),8==(8&o)&&(s=BigInt(1e6*Date.now())),await c.promises.utimes(f,Number(i),Number(s)),0}),["i32","i32","i32","i32","i64","i64","i32"],["i32"]),u("path_link",(function(t,e,n,r,i,s,o){if(n=Number(n),r=Number(r),s=Number(s),o=Number(o),0===n||0===s)return 28;const a=J.get(this);let u,c;t===i?u=c=a.fds.get(t,b.PATH_LINK_SOURCE|b.PATH_LINK_TARGET,BigInt(0)):(u=a.fds.get(t,b.PATH_LINK_SOURCE,BigInt(0)),c=a.fds.get(i,b.PATH_LINK_TARGET,BigInt(0)));const{HEAPU8:f}=et(this),h=nt(this),g=st(h,u,ut.decode(f.subarray(n,n+r)),e),d=I(c.realPath,ut.decode(f.subarray(s,s+o)));return h.linkSync(g,d),0}),(async function(t,e,n,r,i,s,o){if(n=Number(n),r=Number(r),s=Number(s),o=Number(o),0===n||0===s)return 28;const a=J.get(this);let u,c;t===i?u=c=a.fds.get(t,b.PATH_LINK_SOURCE|b.PATH_LINK_TARGET,BigInt(0)):(u=a.fds.get(t,b.PATH_LINK_SOURCE,BigInt(0)),c=a.fds.get(i,b.PATH_LINK_TARGET,BigInt(0)));const{HEAPU8:f}=et(this),h=nt(this),g=await ot(h,u,ut.decode(f.subarray(n,n+r)),e),d=I(c.realPath,ut.decode(f.subarray(s,s+o)));return await h.promises.link(g,d),0}),["i32","i32","i32","i32","i32","i32","i32"],["i32"]),u("path_open",(function(t,e,n,r,i,s,o,a,u){if(n=Number(n),u=Number(u),0===n||0===u)return 28;r=Number(r),s=BigInt(s),o=BigInt(o);const{flags:c,needed_base:h,needed_inheriting:g}=f(i,s,o,a),d=J.get(this),l=d.fds.get(t,h,g),_=et(this),y=_.HEAPU8,E=ut.decode(y.subarray(n,n+r)),p=nt(this),I=st(p,l,E,e),b=p.openSync(I,c,438),m=d.fds.getFileTypeByFd(b);if(0!=(2&i)&&3!==m)return 54;const{base:A,inheriting:T}=H(d.fds.stdio,b,c,m),w=d.fds.insert(b,I,I,m,s&A,o&T,0),B=p.fstatSync(b,{bigint:!0});B.isFile()&&(w.size=B.size,0!=(1024&c)&&(w.pos=B.size));return _.view.setInt32(u,w.id,!0),0}),(async function(t,e,n,r,i,s,o,a,u){if(n=Number(n),u=Number(u),0===n||0===u)return 28;r=Number(r),s=BigInt(s),o=BigInt(o);const{flags:c,needed_base:h,needed_inheriting:g}=f(i,s,o,a),d=J.get(this),l=d.fds.get(t,h,g),_=et(this),y=_.HEAPU8,E=ut.decode(y.subarray(n,n+r)),p=nt(this),I=await ot(p,l,E,e),b=await p.promises.open(I,c,438),m=await d.fds.getFileTypeByFd(b);if(0!=(2&i)&&3!==m)return 54;const{base:A,inheriting:T}=H(d.fds.stdio,b.fd,c,m),w=d.fds.insert(b,I,I,m,s&A,o&T,0),B=await b.stat({bigint:!0});B.isFile()&&(w.size=B.size,0!=(1024&c)&&(w.pos=B.size));return _.view.setInt32(u,w.id,!0),0}),["i32","i32","i32","i32","i32","i64","i64","i32","i32"],["i32"]),u("path_readlink",(function(t,e,n,r,i,s){if(e=Number(e),n=Number(n),r=Number(r),i=Number(i),s=Number(s),0===e||0===r||0===s)return 28;const{HEAPU8:o,view:a}=et(this),u=J.get(this).fds.get(t,b.PATH_READLINK,BigInt(0));let c=ut.decode(o.subarray(e,e+n));c=I(u.realPath,c);const f=nt(this).readlinkSync(c),h=at.encode(f),g=Math.min(h.length,i);return g>=i?42:(o.set(h.subarray(0,g),r),o[r+g]=0,a.setUint32(s,g+1,!0),0)}),(async function(t,e,n,r,i,s){if(e=Number(e),n=Number(n),r=Number(r),i=Number(i),s=Number(s),0===e||0===r||0===s)return 28;const{HEAPU8:o,view:a}=et(this),u=J.get(this).fds.get(t,b.PATH_READLINK,BigInt(0));let c=ut.decode(o.subarray(e,e+n));c=I(u.realPath,c);const f=nt(this),h=await f.promises.readlink(c),g=at.encode(h),d=Math.min(g.length,i);return d>=i?42:(o.set(g.subarray(0,d),r),o[r+d]=0,a.setUint32(s,d+1,!0),0)}),["i32","i32","i32","i32","i32","i32"],["i32"]),u("path_remove_directory",(function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const{HEAPU8:r}=et(this),i=J.get(this).fds.get(t,b.PATH_REMOVE_DIRECTORY,BigInt(0));let s=ut.decode(r.subarray(e,e+n));s=I(i.realPath,s);return nt(this).rmdirSync(s),0}),(async function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const{HEAPU8:r}=et(this),i=J.get(this).fds.get(t,b.PATH_REMOVE_DIRECTORY,BigInt(0));let s=ut.decode(r.subarray(e,e+n));s=I(i.realPath,s);const o=nt(this);return await o.promises.rmdir(s),0}),["i32","i32","i32"],["i32"]),u("path_rename",(function(t,e,n,r,i,s){if(e=Number(e),n=Number(n),i=Number(i),s=Number(s),0===e||0===i)return 28;const o=J.get(this);let a,u;t===r?a=u=o.fds.get(t,b.PATH_RENAME_SOURCE|b.PATH_RENAME_TARGET,BigInt(0)):(a=o.fds.get(t,b.PATH_RENAME_SOURCE,BigInt(0)),u=o.fds.get(r,b.PATH_RENAME_TARGET,BigInt(0)));const{HEAPU8:c}=et(this),f=I(a.realPath,ut.decode(c.subarray(e,e+n))),h=I(u.realPath,ut.decode(c.subarray(i,i+s)));return nt(this).renameSync(f,h),0}),(async function(t,e,n,r,i,s){if(e=Number(e),n=Number(n),i=Number(i),s=Number(s),0===e||0===i)return 28;const o=J.get(this);let a,u;t===r?a=u=o.fds.get(t,b.PATH_RENAME_SOURCE|b.PATH_RENAME_TARGET,BigInt(0)):(a=o.fds.get(t,b.PATH_RENAME_SOURCE,BigInt(0)),u=o.fds.get(r,b.PATH_RENAME_TARGET,BigInt(0)));const{HEAPU8:c}=et(this),f=I(a.realPath,ut.decode(c.subarray(e,e+n))),h=I(u.realPath,ut.decode(c.subarray(i,i+s))),g=nt(this);return await g.promises.rename(f,h),0}),["i32","i32","i32","i32","i32","i32"],["i32"]),u("path_symlink",(function(t,e,n,r,i){if(t=Number(t),e=Number(e),r=Number(r),i=Number(i),0===t||0===r)return 28;const{HEAPU8:s}=et(this),o=J.get(this).fds.get(n,b.PATH_SYMLINK,BigInt(0)),a=ut.decode(s.subarray(t,t+e));let u=ut.decode(s.subarray(r,r+i));u=I(o.realPath,u);return nt(this).symlinkSync(a,u),0}),(async function(t,e,n,r,i){if(t=Number(t),e=Number(e),r=Number(r),i=Number(i),0===t||0===r)return 28;const{HEAPU8:s}=et(this),o=J.get(this).fds.get(n,b.PATH_SYMLINK,BigInt(0)),a=ut.decode(s.subarray(t,t+e));let u=ut.decode(s.subarray(r,r+i));u=I(o.realPath,u);const c=nt(this);return await c.promises.symlink(a,u),0}),["i32","i32","i32","i32","i32"],["i32"]),u("path_unlink_file",(function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const{HEAPU8:r}=et(this),i=J.get(this).fds.get(t,b.PATH_UNLINK_FILE,BigInt(0));let s=ut.decode(r.subarray(e,e+n));s=I(i.realPath,s);return nt(this).unlinkSync(s),0}),(async function(t,e,n){if(e=Number(e),n=Number(n),0===e)return 28;const{HEAPU8:r}=et(this),i=J.get(this).fds.get(t,b.PATH_UNLINK_FILE,BigInt(0));let s=ut.decode(r.subarray(e,e+n));s=I(i.realPath,s);const o=nt(this);return await o.promises.unlink(s),0}),["i32","i32","i32"],["i32"]),this._setMemory=function(e){if(!(e instanceof t.Memory))throw new TypeError('"instance.exports.memory" property must be a WebAssembly.Memory');Q.set(a,j(e))}}static createSync(t,e,n,r,i,s,o){const a=new K({size:3,in:r[0],out:r[1],err:r[2],fs:i,print:s,printErr:o}),u=new ft(t,e,a,!1,i);if(n.length>0)for(let t=0;t<n.length;++t){const e=i.realpathSync(n[t].realPath,"utf8"),r=i.openSync(e,"r",438);a.insertPreopen(r,n[t].mappedPath,e)}return u}static async createAsync(t,e,n,r,i,s,o,a){const u=new z({size:3,in:r[0],out:r[1],err:r[2],print:s,printErr:o}),c=new ft(t,e,u,!0,i,a);if(n.length>0)for(let t=0;t<n.length;++t){const e=n[t],r=await i.promises.realpath(e.realPath),s=await i.promises.open(r,"r",438);await u.insertPreopen(s,e.mappedPath,r)}return c}}const ht=Object.freeze(Object.create(null)),gt=Symbol("kExitCode"),dt=Symbol("kSetMemory"),lt=Symbol("kStarted"),_t=Symbol("kInstance"),yt=Symbol("kBindingName");function Et(t,n){e(n,"instance"),e(n.exports,"instance.exports"),t[_t]=n,t[dt](n.exports.memory)}function pt(t){var i;let s;if(e(t,"options"),void 0!==t.version)switch(n(t.version,"options.version"),t.version){case"unstable":s=ft,this[yt]="wasi_unstable";break;case"preview1":s=ft,this[yt]="wasi_snapshot_preview1";break;default:throw new TypeError(`unsupported WASI version "${t.version}"`)}else s=ft,this[yt]="wasi_snapshot_preview1";void 0!==t.args&&function(t,e){if(!Array.isArray(t))throw new TypeError(`${e} must be an array. Received ${null===t?"null":typeof t}`)}(t.args,"options.args");const o=(null!==(i=t.args)&&void 0!==i?i:[]).map(String),a=[];void 0!==t.env&&(e(t.env,"options.env"),Object.entries(t.env).forEach((({0:t,1:e})=>{void 0!==e&&a.push(`${t}=${e}`)})));const u=[];if(void 0!==t.preopens&&(e(t.preopens,"options.preopens"),Object.entries(t.preopens).forEach((({0:t,1:e})=>u.push({mappedPath:String(t),realPath:String(e)})))),u.length>0){if(void 0===t.fs)throw new Error("filesystem is disabled, can not preopen directory");try{e(t.fs,"options.fs")}catch(t){throw new TypeError("Node.js fs like implementation is not provided")}}void 0!==t.print&&r(t.print,"options.print"),void 0!==t.printErr&&r(t.printErr,"options.printErr"),void 0!==t.returnOnExit&&function(t,e){if("boolean"!=typeof t)throw new TypeError(`${e} must be a boolean. Received ${null===t?"null":typeof t}`)}(t.returnOnExit,"options.returnOnExit");return{args:o,env:a,preopens:u,stdio:[0,1,2],_WASI:s}}function It(t,e){this[dt]=t,this.wasiImport=e,this[lt]=!1,this[gt]=0,this[_t]=void 0}class bt{constructor(t=ht){const{args:e,env:n,preopens:r,stdio:i,_WASI:s}=pt.call(this,t),o=s.createSync(e,n,r,i,t.fs,t.print,t.printErr),a=o._setMemory;delete o._setMemory,It.call(this,a,o),t.returnOnExit&&(o.proc_exit=mt.bind(this))}start(t){if(this[lt])throw new Error("WASI instance has already started");this[lt]=!0,Et(this,t);const{_start:e,_initialize:n}=this[_t].exports;let s;r(e,"instance.exports._start"),i(n,"instance.exports._initialize");try{s=e()}catch(t){if(t!==gt)throw t}return s instanceof Promise?s.then((()=>this[gt]),(t=>{if(t!==gt)throw t;return this[gt]})):this[gt]}initialize(t){if(this[lt])throw new Error("WASI instance has already started");this[lt]=!0,Et(this,t);const{_start:e,_initialize:n}=this[_t].exports;if(i(e,"instance.exports._start"),void 0!==n)return r(n,"instance.exports._initialize"),n()}getImportObject(){return{[this[yt]]:this.wasiImport}}}function mt(t){throw this[gt]=t,gt}async function At(t=ht){const n=Object.create(bt.prototype),{args:i,env:s,preopens:o,stdio:a,_WASI:u}=pt.call(n,t);void 0!==t.asyncify&&(e(t.asyncify,"options.asyncify"),r(t.asyncify.wrapImportFunction,"options.asyncify.wrapImportFunction"));const c=await u.createAsync(i,s,o,a,t.fs,t.print,t.printErr,t.asyncify),f=c._setMemory;return delete c._setMemory,It.call(n,f,c),t.returnOnExit&&(c.proc_exit=mt.bind(n)),n}export{c as Asyncify,Y as Memory,bt as WASI,G as WebAssemblyMemory,d as asyncifyLoad,_ as asyncifyLoadSync,At as createAsyncWASI,j as extendMemory,g as load,l as loadSync,Z as wrapAsyncExport,V as wrapAsyncImport,q as wrapExports};
